<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Selección de Activos</title>
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #1a237e; padding: 6px 8px; }
        th { background: #1a237e; color: #fff; }
        .add-form { margin-top: 20px; }
        .btn { background: #1a237e; color: #fff; border: none; padding: 6px 14px; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #3949ab; }
    </style>
</head>
<body>
    <h2>Seleccione los activos de información</h2>
    <form id="assetsForm">
        <table>
            <thead>
                <tr>
                    <th></th>
                    <th>Sistema</th>
                    <th>Descripción</th>
                </tr>
            </thead>
            <tbody id="assetsTableBody">
                <!-- Aquí se cargan los activos desde el JSON -->
            </tbody>
        </table>
        <button type="submit" class="btn">Guardar selección</button>
    </form>

    <div class="add-form">
        <h3>Agregar otro activo manualmente</h3>
        <form id="addAssetForm">
            <input type="text" id="nuevoSistema" placeholder="Sistema" required>
            <input type="text" id="nuevaDescripcion" placeholder="Descripción" required>
            <button type="submit" class="btn">Agregar activo</button>
        </form>
    </div>

    <script>
        let activosJSON = [];

        // Cargar activos desde el JSON
        fetch('../assets/assets.json')
            .then(response => response.json())
            .then(data => {
                activosJSON = data;
                const tbody = document.getElementById('assetsTableBody');
                data.forEach((item, idx) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><input type="checkbox" name="activo[]" value="${item.sistema}|||${item.descripcion}"></td>
                        <td>${item.sistema}</td>
                        <td>${item.descripcion}</td>
                    `;
                    tbody.appendChild(tr);
                });
            });

        // Agregar nuevo activo manualmente
        document.getElementById('addAssetForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const sistema = document.getElementById('nuevoSistema').value;
            const descripcion = document.getElementById('nuevaDescripcion').value;
            const tbody = document.getElementById('assetsTableBody');
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="checkbox" name="activo[]" value="${sistema}|||${descripcion}|||manual"></td>
                <td>${sistema}</td>
                <td>${descripcion}</td>
            `;
            tbody.appendChild(tr);
            this.reset();
        });

        // Guardar selección en LocalStorage
        document.getElementById('assetsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const seleccionados = [];
            document.querySelectorAll('input[type="checkbox"][name="activo[]"]:checked').forEach(cb => {
                const partes = cb.value.split('|||');
                // Si es manual, solo tiene sistema y descripcion
                if (partes[2] === 'manual') {
                    seleccionados.push({
                        sistema: partes[0],
                        descripcion: partes[1],
                        manual: true
                    });
                } else {
                    // Buscar el objeto completo en el JSON
                    const encontrado = activosJSON.find(a => a.sistema === partes[0] && a.descripcion === partes[1]);
                    if (encontrado) {
                        seleccionados.push({...encontrado, manual: false});
                    }
                }
            });
            // Guardar en localStorage
            localStorage.setItem('activosSeleccionados', JSON.stringify(seleccionados));
            // Redirigir a inventory
            window.location.href = 'assets_inventory.html';
        });
    </script>
</body>
</html>